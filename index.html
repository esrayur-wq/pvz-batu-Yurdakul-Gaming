<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dijital BaÄŸÄ±mlÄ±lÄ±k Test Sistemi</title>

<style>
/* --------------------------------------------------------
   GENEL TASARIM
-------------------------------------------------------- */
body {
    margin: 0;
    background: #1d1d1d;
    color: white;
    font-family: Arial, sans-serif;
    text-align: center;
}

h1 {
    margin-top: 20px;
    font-size: 36px;
    color: #ffca3a;
    text-shadow: 0 0 12px rgba(0,0,0,0.8);
}

/* --------------------------------------------------------
   GÄ°RÄ°Å EKRANI
-------------------------------------------------------- */
#loginBox {
    width: 420px;
    margin: 40px auto;
    padding: 25px;
    background: #2b2b2b;
    border-radius: 16px;
    box-shadow: 0 0 30px rgba(0,0,0,0.45);
}

input {
    width: 85%;
    padding: 14px;
    margin-top: 12px;
    border: none;
    border-radius: 12px;
    text-align: center;
    font-size: 17px;
}

button {
    margin-top: 20px;
    padding: 14px 32px;
    border: none;
    border-radius: 12px;
    background: #ffca3a;
    color: black;
    font-size: 20px;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 0 10px black;
}

/* --------------------------------------------------------
   TEST EKRANI
-------------------------------------------------------- */
#testScreen {
    display: none;
    width: 420px;
    height: 260px;
    background: #333;
    margin: 30px auto;
    border-radius: 15px;
    font-size: 70px;
    justify-content: center;
    align-items: center;
}


/* --------------------------------------------------------
   SINAV EKRANI
-------------------------------------------------------- */
#examScreen {
    display: none;
    width: 520px;
    margin: 30px auto;
    padding: 20px;
    background: #2c2c2c;
    border-radius: 16px;
    box-shadow: 0 0 20px black;
}

/* --------------------------------------------------------
   REHBER GÄ°RÄ°Å
-------------------------------------------------------- */
#teacherLoginOverlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.85);
    color: white;
    z-index: 999999;
    justify-content: center;
    align-items: center;
    flex-direction: column;
}


#teacherLoginOverlay input {
    padding:12px; 
    font-size:18px; 
    border-radius:8px; 
    width:240px; 
    text-align:center;
}

/* --------------------------------------------------------
   REHBER PANELÄ°
-------------------------------------------------------- */
#teacherPanel {
    display:none; 
    position:fixed; 
    top:0; left:0; 
    width:100%; height:100%; 
    background:#111; 
    color:white; 
    overflow-y:auto; 
    padding:35px; 
    z-index:999999;
}

table {
    width:100%; 
    border-collapse:collapse; 
    margin-top:20px; 
    font-size:15px;
}

th, td {
    border:1px solid #555; 
    padding:6px; 
    text-align:center;
}

th {
    background:#222;
}

/* Silme butonu */
.deleteBtn {
    background:#d11;
    color:white;
    padding:10px 20px;
    border-radius:10px;
    font-size:18px;
    cursor:pointer;
    margin-top:20px;
}

/* --------------------------------------------------------
   GIF ALANI
-------------------------------------------------------- */
#gifArea {
    position: absolute;   /* â— fixed DEÄÄ°L */
    width: 180px;
    height: 180px;
    display: none;
    z-index: 1;
    pointer-events: none;
}


   




#gifArea img {
    width: 100%;
    height: 100%;
    border-radius: 14px;
}

/* --------------------------------------------------------
   YÃ–NERGE EKRANI
-------------------------------------------------------- */
#instructionOverlay {
    display:none;
    position:fixed;
    top:0; left:0;
    width:100%; height:100%;
    background: rgba(0,0,0,0.92);
    z-index: 99999;
    color:white;
    font-size:22px;
    padding-top:40px;
}

#instructionBox {
    width: 70%;
    max-width: 650px;
    margin: auto;
    background:#2d2d2d;
    padding: 30px;
    border-radius: 15px;
    border:2px solid #ffca3a;
    box-shadow:0 0 20px black;
}

/* Ã–ÄŸrenci gÃ¶rmesin diye sÄ±nav puanÄ± mesajÄ± gizlenecek */
.hiddenExamMessage {
    display:none !important;
}
/* --------------------------------------------------------
   GIF GÃœVENLÄ° ALAN
-------------------------------------------------------- */
#gifSafeZone {
    position: fixed;
    right: 20px;
    bottom: 20px;
    width: 220px;
    height: 220px;
    pointer-events: none;
    z-index: 1;
}
/* --------------------------------------------------------
   YAZIYI HER ZAMAN ÃœSTE AL
-------------------------------------------------------- */
#testScreen,
#examScreen {
    position: relative;
    z-index: 10;   /* ğŸ”’ GIF ve emoji bunun ALTINDA kalÄ±r */
}
/* --------------------------------------------------------
   GIF & EMOJI ALT KATMAN
-------------------------------------------------------- */
#gifSafeZone,
#gifArea {
    position: fixed;
    z-index: 1;    /* ğŸ”½ yazÄ±dan dÃ¼ÅŸÃ¼k */
    pointer-events: none;
}
#gifArea {
    position: absolute;
    left: 0;
    top: 0;
}

</style>
</head>

<body>

<h1>Dijital BaÄŸÄ±mlÄ±lÄ±k Test Sistemi</h1>


<!-- --------------------------------------------------------
     Ã–ÄRENCÄ° GÄ°RÄ°Å EKRANI
-------------------------------------------------------- -->
<div id="loginBox">
    <h2>Ã–ÄŸrenci GiriÅŸi</h2>
    <input id="studentName" placeholder="Ad Soyad">
    <input id="studentClass" placeholder="SÄ±nÄ±f / Numara">
    <button onclick="startSystem()">BaÅŸla</button>

    <br><br>
    <button onclick="openTeacherLogin()" style="background:#888;">Rehberlik GiriÅŸi</button>
</div>


<!-- --------------------------------------------------------
     TEST EKRANI
-------------------------------------------------------- -->
<div id="testScreen"></div>


<!-- --------------------------------------------------------
     SINAV EKRANI
-------------------------------------------------------- -->
<div id="examScreen">
    <h2 id="examQuestion"></h2>
    <div id="examAnswers"></div>
    <h3 id="examTimer">Kalan SÃ¼re: 5:00</h3>
</div>


<!-- --------------------------------------------------------
     GIF ALANI
-------------------------------------------------------- -->
<!-- --------------------------------------------------------
     GIF GÃœVENLÄ° ALAN
-------------------------------------------------------- -->
<div id="gifSafeZone">
    <div id="gifArea">
        <img id="gifImg" src="">
    </div>
</div>



<!-- --------------------------------------------------------
     YÃ–NERGE EKRANI (Fullscreen)
-------------------------------------------------------- -->
<div id="instructionOverlay">
    <div id="instructionBox">
        <h2 id="instTitle"></h2>
        <p id="instText"></p>
        <button onclick="hideInstruction()" style="padding:12px 25px; font-size:22px;">BAÅLA</button>
    </div>
</div>


<!-- --------------------------------------------------------
     REHBER GÄ°RÄ°Å POP-UP
-------------------------------------------------------- -->
<div id="teacherLoginOverlay">
    <h2>Rehberlik Paneli GiriÅŸi</h2>
    <p>Åifreyi Girin:</p>
    <input id="teacherPass" type="password" placeholder="Åifre">
    <br>
    <button onclick="enterTeacherPanel()" 
            style="padding:12px 25px; font-size:18px; border-radius:8px; background:#08f; color:white;">
        GiriÅŸ Yap
    </button>
</div>


<!-- --------------------------------------------------------
     REHBER PANELÄ° (CSV Ä°NDÄ°R + TÃœMÃœ SÄ°L)
-------------------------------------------------------- -->
<div id="teacherPanel">

    <h1>ğŸ“Š Rehberlik Ã–ÄŸrenci SonuÃ§ Paneli</h1>
    <p>TÃ¼m test + sÄ±nav sonuÃ§larÄ± burada gÃ¶rÃ¼nÃ¼r.</p>
    <hr style="border-color:#444;">

    <table>
        <thead>
            <tr>
                <th>Ad</th>
                <th>SÄ±nÄ±f</th>
                <th>Tarih</th>
                <th>Dikkat</th>
                <th>DaÄŸ.</th>
                <th>Ã–dÃ¼l</th>
                <th>Hiper</th>
                <th>Stroop</th>
                <th>DÃ¼rt.</th>
                <th>SÄ±nav</th>
                <th>Toplam %</th>
            </tr>
        </thead>
        <tbody id="panelTableBody"></tbody>
    </table>

    <button class="deleteBtn" onclick="deleteAllAndDownload()">
        ğŸ“¥ TÃ¼m KayÄ±tlarÄ± Ä°ndir + âŒ Sil
    </button>

    <br><br>
    <button onclick="closeTeacherPanel()" 
            style="padding:10px 20px; font-size:18px; border-radius:8px; background:#333; color:white;">
        Kapat
    </button>
</div>

<script type="module">

/* ---------------------------------------------------
   FIREBASE BAÄLANTISI (DEÄÄ°ÅTÄ°RÄ°LECEK ALAN)
--------------------------------------------------- */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
import { 
    getFirestore, 
    collection, 
    addDoc, 
    getDocs,
    deleteDoc,
    doc
} from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";


const firebaseConfig = {
    apiKey: "AIzaSyAZx2LiyJY-d4zx4n7I1Kutd1CfKhNdwVE",
    authDomain: "dijital-bagimlilik-test.firebaseapp.com",
    projectId: "dijital-bagimlilik-test",
    storageBucket: "dijital-bagimlilik-test.appspot.com",
    messagingSenderId: "137997296088",
    appId: "1:137997296088:web:ddb3e0a343d08b3b6552ad"
};

const app = initializeApp(firebaseConfig);
const db  = getFirestore(app);
const studentsCol = collection(db, "students");

window.db = db;
window.studentsCol = studentsCol;


/* ---------------------------------------------------
   FIREBASE â†’ KAYIT EKLE
--------------------------------------------------- */
window.saveStudentResult = async function (data) {
    try {
        await addDoc(studentsCol, data);
        console.log("KayÄ±t baÅŸarÄ±lÄ±:", data);
    } catch (err) {
        console.error("KayÄ±t hatasÄ±:", err);
    }
};


/* ---------------------------------------------------
   FIREBASE â†’ VERÄ° Ã‡EK & REHBER PANELÄ°NE YAZDIR
--------------------------------------------------- */
window.loadStudents = async function () {

    let table = document.getElementById("panelTableBody");
    table.innerHTML = "";

    try {
        const snap = await getDocs(studentsCol);

        snap.forEach(docu => {
            let d = docu.data();

            table.innerHTML += `
            <tr>
                <td>${d.name}</td>
                <td>${d.class}</td>
                <td>${d.date}</td>
                <td>${d.dikkat}</td>
                <td>${d.daginiklik}</td>
                <td>${d.odul}</td>
                <td>${d.hiper}</td>
                <td>${d.stroop}</td>
                <td>${d.durtu}</td>
                <td>${d.sinav}</td>
                <td><b>${d.totalPercent}%</b></td>
            </tr>`;
        });

    } catch (err) {
        console.error("Veri Ã§ekme hatasÄ±:", err);
    }
};


/* ---------------------------------------------------
   TÃœM VERÄ°LERÄ° CSV Ä°NDÄ°R + FIREBASE'DAN SÄ°L
--------------------------------------------------- */

window.deleteAllAndDownload = async function() {
    const snap = await getDocs(studentsCol);
    let rows = [
        ["Ad","SÄ±nÄ±f","Tarih","Dikkat","DaÄŸ.","Ã–dÃ¼l","Hiper","Stroop","DÃ¼rtÃ¼","SÄ±nav","Toplam %"]
    ];

    for (let d of snap.docs) {
        let x = d.data();
        rows.push([ 
            x.name, x.class, x.date, x.dikkat, x.daginiklik, x.odul, 
            x.hiper, x.stroop, x.durtu, x.sinav, x.totalPercent
        ]);
    }

    // CSV Ã¼ret
    let csv = rows.map(r => r.join(",")).join("\n");
    let blob = new Blob([csv], {type:"text/csv"});
    let url = URL.createObjectURL(blob);

    // Ä°ndir
    let a = document.createElement("a");
    a.href = url;
    a.download = "ogrenci_sonuclari.csv";
    a.click();

    // Firestoreâ€™dan sil
    for (let d of snap.docs) {
        await deleteDoc(doc(db, "students", d.id));
    }

    alert("ğŸ“¥ TÃ¼m kayÄ±tlar indirildi ve Firestore'dan silindi!");

    loadStudents();
};

</script>



<script>
/* ============================================================
   PART 3 â€” 7 TESTÄ°N TAM MANTIÄI (RASTGELE + 10 HEDEF KURALI)
============================================================= */

let currentTest = 1;
let studentName = "";
let studentClass = "";

let testScores = {
    dikkat: 0,
    daginiklik: 0,
    odul: 0,
    hiper: 0,
    stroop: 0,
    durtu: 0
};

let testScreen = document.getElementById("testScreen");
function clearEvents() {
    document.onkeydown = null;
    testScreen.onclick = null;
}


/* ---------------------------------------------------
   YARDIMCI â€” DÄ°ZÄ° KARIÅTIR
--------------------------------------------------- */
function shuffle(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
        let j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
}


/* ---------------------------------------------------
   1) DÄ°KKAT TESTÄ° â€” En az 10 tane 5
--------------------------------------------------- */
function dikkatTesti() {
clearEvents();
    let hit = 0, wrong = 0;

    let seq = [];
    for (let i = 0; i < 10; i++) seq.push(5);
    while (seq.length < 45) {
        let n = Math.floor(Math.random() * 9) + 1;
        if (n !== 5) seq.push(n);
    }

    shuffle(seq);

    let index = 0;
    testScreen.style.display = "flex";

    let interval = setInterval(() => {

        let num = seq[index];
        testScreen.innerHTML = num;

        document.onkeydown = (e) => {
            if (e.code === "Space") {
                if (num === 5) hit++;
                else wrong++;
            }
        };

        index++;
        if (index >= seq.length) {
            clearInterval(interval);
            let puan = hit * 2.5 - wrong;
            puan = Math.max(0, Math.min(20, puan));
            testScores.dikkat = puan;

            currentTest++;
            runTest();
        }

    }, 700);
}


/* ---------------------------------------------------
   2) DÄ°KKAT DAÄINIKLIÄI â€” 10 hedef
--------------------------------------------------- */
function daginiklikTesti() {
clearEvents();
    let hit = 0, wrong = 0;

    let seq = new Array(10).fill("target")
              .concat(new Array(10).fill("other"));
    shuffle(seq);

    let index = 0;
    testScreen.style.display = "flex";

    let interval = setInterval(() => {
        let t = seq[index];

        if (t === "target") {
            testScreen.innerHTML = "â– ";
            testScreen.style.color = "red";
            testScreen.onclick = () => hit++;
        } else {
            let arr = ["â˜…","â˜º","â—","â™¥"];
            testScreen.innerHTML = arr[Math.floor(Math.random()*arr.length)];
            testScreen.style.color = "yellow";
            testScreen.onclick = () => wrong++;
        }

        index++;
        if (index >= seq.length) {
            clearInterval(interval);
            let puan = hit * 2.5 - wrong;
            puan = Math.max(0, Math.min(20, puan));
            testScores.daginiklik = puan;

            currentTest++;
            runTest();
        }

    }, 800);
}


/* ---------------------------------------------------
   3) Ã–DÃœL TESTÄ° â€” 10 tane â€œ2 PUANâ€
--------------------------------------------------- */
function odulTesti() {
clearEvents();
    let hit = 0, wrong = 0;

    let seq = [];
    for (let i=0;i<10;i++) seq.push(2);
    for (let i=0;i<10;i++) seq.push(1);
    for (let i=0;i<10;i++) seq.push(3);

    shuffle(seq);

    let index = 0;
    testScreen.style.display = "flex";

    let interval = setInterval(() => {

        let n = seq[index];

        if (n === 2) {
            testScreen.innerHTML = "2 PUAN";
            testScreen.onclick = () => hit++;
        } else {
            testScreen.innerHTML = n + " PUAN";
            testScreen.onclick = () => wrong++;
        }

        index++;
        if (index >= seq.length) {
            clearInterval(interval);

            let puan = hit * 2.5 - wrong;
            puan = Math.max(0, Math.min(20, puan));
            testScores.odul = puan;

            currentTest++;
            runTest();
        }

    }, 800);
}


/* ---------------------------------------------------
   4) HÄ°PERAKTÄ°VÄ°TE â€” Mavi tÄ±kla / KÄ±rmÄ±zÄ± bekle
--------------------------------------------------- */
function hiperaktiviteTesti() {
clearEvents();
    let hit = 0, wrong = 0;

    let seq = new Array(10).fill("blue")
              .concat(new Array(10).fill("red"));
    shuffle(seq);

    let index = 0;
    testScreen.style.display = "flex";

    let interval = setInterval(() => {

        let c = seq[index];
        testScreen.style.background = c;
        testScreen.innerHTML = "";

        testScreen.onclick = () => {
            if (c === "blue") hit++;
            else wrong++;
        };

        index++;
        if (index >= seq.length) {
            clearInterval(interval);
            testScreen.style.background = "#333";

            let puan = hit * 2.5 - wrong;
            puan = Math.max(0, Math.min(20, puan));
            testScores.hiper = puan;

            currentTest++;
            runTest();
        }

    }, 600);
}


/* ---------------------------------------------------
   5) STROOP TESTÄ°
--------------------------------------------------- */
/* ---------------------------------------------------
   5) STROOP TESTÄ° â€” RENK = KELÄ°ME â†’ TIKLA
--------------------------------------------------- */
function stroopTesti() {
    clearEvents();
    let hit = 0, wrong = 0;

    const renkler = ["kÄ±rmÄ±zÄ±", "mavi", "yeÅŸil"];
    const renkKod = { kÄ±rmÄ±zÄ±:"red", mavi:"blue", yeÅŸil:"green" };

    let seq = [];

    // 10 DOÄRU (RENK = KELÄ°ME)
    for (let i = 0; i < 10; i++) {
        let r = renkler[Math.floor(Math.random() * 3)];
        seq.push({ kelime: r, renk: r });
    }

    // 10 YANILTICI (RENK â‰  KELÄ°ME)
    for (let i = 0; i < 10; i++) {
        let kelime = renkler[Math.floor(Math.random() * 3)];
        let renk = kelime;
        while (renk === kelime) {
            renk = renkler[Math.floor(Math.random() * 3)];
        }
        seq.push({ kelime, renk });
    }

    shuffle(seq);

    let index = 0;
    testScreen.style.display = "flex";

    let interval = setInterval(() => {

        let item = seq[index];
        testScreen.innerHTML = item.kelime.toUpperCase();
        testScreen.style.color = renkKod[item.renk];

        testScreen.onclick = () => {
            if (item.kelime === item.renk) hit++;
            else wrong++;
        };

        index++;
        if (index >= seq.length) {
            clearInterval(interval);
            testScreen.style.color = "white";

            let puan = hit * 2.5 - wrong;
            puan = Math.max(0, Math.min(20, puan));
            testScores.stroop = puan;

            currentTest++;
            runTest();
        }

    }, 1200);
}



/* ---------------------------------------------------
   6) DÃœRTÃœSELLÄ°K â€” TIKLA / BEKLE
--------------------------------------------------- */
function durtusellikTesti() {
    clearEvents();
    let hit = 0, wrong = 0;

    let seq = new Array(10).fill("TIKLA")
              .concat(new Array(10).fill("BEKLE"));

    shuffle(seq);

    let index = 0;
    testScreen.style.display = "flex";

    let interval = setInterval(() => {

        let w = seq[index];
        testScreen.innerHTML = w;

        testScreen.onclick = () => {
    testScreen.onclick = null; // ikinci tÄ±klamayÄ± engelle
    if (w === "TIKLA") hit++;
    else wrong++;
};

        

        index++;
        if (index >= seq.length) {
            clearInterval(interval);

            let puan = hit * 2.5 - wrong;
            puan = Math.max(0, Math.min(20, puan));
            testScores.durtu = puan;

            currentTest++;
            runTest();
        }

    }, 800);
}


/* ---------------------------------------------------
   TEST GEÃ‡Ä°ÅLERÄ°
--------------------------------------------------- */
function runTest() {

    testScreen.style.display = "flex";
    testScreen.style.background = "#333";
    testScreen.innerHTML = "";

    startGifSystem(); // GIF/emoji sistemi aktif

    if (currentTest === 1) showInstruction(
        "DÄ°KKAT TESTÄ°",
        "Sadece <b>5</b> gÃ¶rÃ¼nce boÅŸluk tuÅŸuna bas.",
        () => dikkatTesti()
    );

    else if (currentTest === 2) showInstruction(
        "DÄ°KKAT DAÄINIKLIÄI",
        "KÄ±rmÄ±zÄ± kare gÃ¶rÃ¼nce <b>tÄ±kla</b>. DiÄŸerlerine dokunma.",
        () => daginiklikTesti()
    );

    else if (currentTest === 3) showInstruction(
        "Ã–DÃœL DUYARLILIÄI",
        "'<b>2 PUAN</b>' yazÄ±sÄ± Ã§Ä±kÄ±nca tÄ±kla. DiÄŸerlerine basma.",
        () => odulTesti()
    );

    else if (currentTest === 4) showInstruction(
        "HÄ°PERAKTÄ°VÄ°TE",
        "Ekran <b>mavi</b> olursa tÄ±kla. <b>KÄ±rmÄ±zÄ±</b> olursa dokunma.",
        () => hiperaktiviteTesti()
    );

 



   else if (currentTest === 5) showInstruction(
    "STROOP TESTÄ°",
    "YazÄ±ya deÄŸil, <b>YAZI RENGÄ°NE</b> bak.<br><br>" +
    "EÄER:<br>" +
    "YazÄ±nÄ±n RENGÄ° ile YAZDIÄI kelime AYNIYSA âœ <b>TIKLA</b><br><br>" +
    "FARKLIYSA âœ <b>HÄ°Ã‡BÄ°R ÅEY YAPMA</b>",
    () => stroopTesti()

);
else if (currentTest === 6) showInstruction(
    "DÃœRTÃœSELLÄ°K",
    "'TIKLA' yazarsa tÄ±kla. 'BEKLE' yazarsa tÄ±klama.",
    () => durtusellikTesti()
);


    else if (currentTest === 7) showInstruction(
        "10 SORULUK SINAV",
        "SÃ¼ren <b>5 dakika</b>. Her soru 10 puan.",
        () => startExam()
    );
}




/* ============================================================
   PART 4 â€“ SINAV MOTORU (10 SORU + GERÄ° SAYIM)
============================================================= */

let examQuestions = [];
let examIndex = 0;
let examScore = 0;
let examTimer = 300;
let examInterval;

function buildExamQuestions() {
    examQuestions = [
        { q:"2 - 4 - 6 - 8 - ?", a:["9","10","12"], c:1 },

        { q:"FarklÄ± olan hangisi?<br>â— â— â– ", a:["â—","â—","â– "], c:2 },

        { q:"3 sandalye ve 2 masa toplam kaÃ§ eÅŸyadÄ±r?", a:["3","5","6"], c:1 },

        { q:"En kÃ¼Ã§Ã¼k sayÄ± hangisidir?", a:["15","9","21"], c:1 },

        { q:"Ã–ÄŸretmen konuÅŸurken ne yapÄ±lmalÄ±dÄ±r?", a:["Araya girilir","Sessizce dinlenir","YÃ¼rÃ¼nÃ¼r"], c:1 },

        { q:"Dur levhasÄ± ne anlama gelir?", a:["DÃ¶n","Dur","HÄ±zlan"], c:1 },

        /* âœ… STROOP â€” AÃ‡IK VE NET */
        {
            q: "YAZININ RENGÄ° NEDÄ°R?<br><br>" +
               "<span style='color:red; font-size:32px;'>MAVÄ°</span>",
            a: ["KÄ±rmÄ±zÄ±","Mavi","YeÅŸil"],
            c: 0
        },
        {
            q: "YAZININ RENGÄ° NEDÄ°R?<br><br>" +
               "<span style='color:blue; font-size:32px;'>KIRMIZI</span>",
            a: ["Mavi","KÄ±rmÄ±zÄ±","YeÅŸil"],
            c: 0
        },

        /* âœ… YILDIZ SORUSU â€” HÄ°ZALI */
        {
            q: "Hangi satÄ±rda daha Ã§ok yÄ±ldÄ±z vardÄ±r?<br><br>" +
               "<div style='font-size:28px;'>â˜…â˜…â˜…â˜…</div>" +
               "<div style='font-size:28px;'>â˜…â˜…â˜…</div>",
            a: ["Ãœstteki","Alttaki","EÅŸit"],
            c: 0
        },

        { q:"Hangi ÅŸekil daha bÃ¼yÃ¼ktÃ¼r?", a:["â¬›","â¬œ","AynÄ±"], c:2 }
    ];

    examIndex = 0;
    examScore = 0;
}



function startExam() {
clearEvents()
    buildExamQuestions();

    document.getElementById("testScreen").style.display = "none";
    document.getElementById("examScreen").style.display = "block";

    examTimer = 300;
    updateExamUI();
    startExamTimer();
}


function updateExamUI() {
    let q = examQuestions[examIndex];

    document.getElementById("examQuestion").innerHTML = 
        (examIndex + 1) + ") " + q.q;

    let ansDiv = document.getElementById("examAnswers");
    ansDiv.innerHTML = "";

    q.a.forEach((x,i) => {
        let btn = document.createElement("button");
        btn.innerHTML = x;
        btn.style.margin = "8px";
        btn.onclick = () => answerExam(i);
        ansDiv.appendChild(btn);
    });
}


function answerExam(i) {
    let q = examQuestions[examIndex];

    if (i === q.c) examScore += 10;

    examIndex++;
    if (examIndex >= examQuestions.length) finishExam();
    else updateExamUI();
}


function startExamTimer() {

    examInterval = setInterval(() => {
        examTimer--;

        let m = Math.floor(examTimer / 60);
        let s = examTimer % 60;
        if (s < 10) s = "0" + s;

        document.getElementById("examTimer").innerHTML =
            "Kalan SÃ¼re: " + m + ":" + s;

        if (examTimer <= 0) {
            clearInterval(examInterval);
            finishExam();
        }
    }, 1000);
}


function finishExam() {

    clearInterval(examInterval);

    document.getElementById("examScreen").style.display = "none";

    // Ã–ÄŸrenciye puan gÃ¶sterme YOK
    saveFinalData();
}




/* ============================================================
   PART 5 â€” TÃœM SONUCU FIREBASEâ€™A KAYDET
============================================================= */

function saveFinalData() {

    // ğŸ”¹ SINAV TOPLAM BONUSU (MAX 5 PUAN)
    let examTotalBonus = Math.min(5, examScore / 20);
    // examScore max 100 â†’ 5 puan

    let perTestBonus = examTotalBonus / 6;

    let finalScores = {
        dikkat: Math.min(20, testScores.dikkat + perTestBonus),
        daginiklik: Math.min(20, testScores.daginiklik + perTestBonus),
        odul: Math.min(20, testScores.odul + perTestBonus),
        hiper: Math.min(20, testScores.hiper + perTestBonus),
        stroop: Math.min(20, testScores.stroop + perTestBonus),
        durtu: Math.min(20, testScores.durtu + perTestBonus)
    };

    let totalRaw =
        finalScores.dikkat +
        finalScores.daginiklik +
        finalScores.odul +
        finalScores.hiper +
        finalScores.stroop +
        finalScores.durtu;

    let totalPercent = Math.round((totalRaw / 120) * 100);

    let data = {
        name: studentName,
        class: studentClass,
        date: new Date().toLocaleString(),

        dikkat: finalScores.dikkat.toFixed(1),
        daginiklik: finalScores.daginiklik.toFixed(1),
        odul: finalScores.odul.toFixed(1),
        hiper: finalScores.hiper.toFixed(1),
        stroop: finalScores.stroop.toFixed(1),
        durtu: finalScores.durtu.toFixed(1),

        sinav: examScore, // âœ… panelde gÃ¶rÃ¼nen
        examTotalBonus: examTotalBonus.toFixed(2),
        totalPercent
    };

    // âœ… KAYDET
    saveStudentResult(data);
// efektleri durdur
if (gifInterval) {
    clearInterval(gifInterval);
    gifInterval = null;
}
bgMusic.pause();
bgMusic.currentTime = 0;

   // BÄ°TTÄ° EKRANI
testScreen.style.display = "flex";
testScreen.style.background = "#333";
testScreen.style.fontSize = "48px";
testScreen.innerHTML = "BÄ°TTÄ° âœ”";

// 3 saniye sonra lobiye dÃ¶n
setTimeout(() => {
    location.reload();
}, 3000);

}








/* ============================================================
   PART 6 â€” SES + GIF + EMOJI SÄ°STEMÄ°
============================================================= */

const giflist = [
    "https://media.giphy.com/media/JIX9t2j0ZTN9S/giphy.gif",
    "https://media.giphy.com/media/3oriO0OEd9QIDdllqo/giphy.gif",
    "https://media.giphy.com/media/11s7Ke7jcNxCHS/giphy.gif",
    "https://media.giphy.com/media/10dU7AN7xsi1I4/giphy.gif",
    "https://media.giphy.com/media/l3vR85PnGsBwu1PFK/giphy.gif",
    "https://media.giphy.com/media/MDJ9IbxxvDUQM/giphy.gif",
    "https://media.giphy.com/media/fAnEC88LccN7a/giphy.gif"
];

const emojiList = ["ğŸ˜‚","ğŸ˜¹","ğŸ¤£","ğŸ¤ª","ğŸ˜›","ğŸ˜…","â­","âš¡","ğŸ’¥"];

let effectSound = new Audio("https://cdn.pixabay.com/audio/2022/03/15/audio_3b40fb33a7.mp3");
effectSound.volume = 0.4;

let bgMusic = new Audio("https://cdn.pixabay.com/audio/2023/03/05/audio_6c76569998.mp3");
bgMusic.volume = 0.12;
bgMusic.loop = true;

let gifAreaDiv = document.getElementById("gifArea");
let gifImgEl = document.getElementById("gifImg");

let gifIntervalActive = false;


function randomPosition() {
    // gifSafeZone iÃ§inde kÃ¼Ã§Ã¼k rastgele oynama
    let x = Math.random() * 20;  // 0â€“20px
    let y = Math.random() * 20;  // 0â€“20px
    return { x, y };
}



function showRandomGif() {

    effectSound.pause();
    effectSound.currentTime = 0;
    effectSound.play();

    let g = giflist[Math.floor(Math.random()*giflist.length)];
    gifImgEl.src = g;

    let pos = randomPosition();
    gifAreaDiv.style.left = pos.x + "px";
    gifAreaDiv.style.top  = pos.y + "px";

    gifAreaDiv.style.display = "block";

    setTimeout(() => gifAreaDiv.style.display = "none", 2400);
}


function showEmoji() {
    let e = emojiList[Math.floor(Math.random()*emojiList.length)];
    let div = document.createElement("div");
    div.innerHTML = e;
    div.style.position = "absolute";
    div.style.right = "40px";
div.style.bottom = "40px";
    div.style.fontSize = "60px";
    let pos = randomPosition();
    div.style.left = pos.x + "px";
    div.style.top = pos.y + "px";
    div.style.zIndex = "2";
div.style.pointerEvents = "none";


    document.body.appendChild(div);

    setTimeout(() => div.remove(), 1800);
}


let gifInterval = null;

function startGifSystem() {
    if (gifInterval) return;

    bgMusic.play().catch(()=>{});

    gifInterval = setInterval(() => {
        Math.random() < 0.6 ? showRandomGif() : showEmoji();
    }, 3000);
}





/* ============================================================
   PART 7 â€” GÄ°RÄ°Å ve REHBER PANELÄ°
============================================================= */

function startSystem() {

    studentName  = document.getElementById("studentName").value;
    studentClass = document.getElementById("studentClass").value;

    if (studentName.trim()==="" || studentClass.trim()==="") {
        alert("LÃ¼tfen bilgileri doldurun.");
        return;
    }

    document.getElementById("loginBox").style.display = "none";

    currentTest = 1;
    runTest();
}


function openTeacherLogin() {
    document.getElementById("teacherLoginOverlay").style.display = "flex";
}


function enterTeacherPanel() {

    let pass = document.getElementById("teacherPass").value;

    if (pass !== "EVRE12345") {
        alert("Åifre yanlÄ±ÅŸ!");
        return;
    }

    document.getElementById("teacherLoginOverlay").style.display = "none";
    document.getElementById("teacherPanel").style.display = "block";

    loadStudents();
}


function closeTeacherPanel() {
    document.getElementById("teacherPanel").style.display = "none";
}




/* ============================================================
   PART 8 â€” YÃ–NERGE EKRANI
============================================================= */

let instructionOverlay = document.getElementById("instructionOverlay");
let instTitle = document.getElementById("instTitle");
let instText  = document.getElementById("instText");

let pendingCallback = null;

function showInstruction(title, text, callback) {
    instTitle.innerHTML = title;
    instText.innerHTML  = text;
    pendingCallback = callback;

    instructionOverlay.style.display = "block";
}

function hideInstruction() {
    instructionOverlay.style.display = "none";
    if (pendingCallback) pendingCallback();
}

</script>

</body>
</html>
