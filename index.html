<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PvZ Batu – YG Edition</title>

<style>
  body{margin:0;background:#225522;user-select:none;overflow:hidden;}

  /* === LOGO EKRANI === */
  #logoScreen {
    position:absolute;top:0;left:0;width:100%;height:100%;
    background:black;display:flex;justify-content:center;
    align-items:center;flex-direction:column;z-index:1000;
  }
  #logoScreen h1 {
    color:white;font-size:60px;font-family:Arial;
    text-shadow:4px 4px 10px yellow;
    animation: glow 1.5s infinite alternate;
  }
  @keyframes glow {
    0%{text-shadow:4px 4px 10px yellow;}
    100%{text-shadow:4px 4px 25px #ffea00;}
  }

  /* === MENÜ === */
  #menuWrapper {
    position:absolute;top:0;left:0;width:100%;height:100%;
    background:linear-gradient(#064f06,#002f00);
    display:none;justify-content:center;align-items:center;
    z-index:500;
  }

  #menuBox {
    width:430px;padding:25px;border-radius:18px;
    background:rgba(0,0,0,0.45);
    border:4px solid yellow;text-align:center;
  }

  .menuButton {
    width:100%;padding:15px;margin:10px 0;
    background:#004d00;color:yellow;border:3px solid yellow;
    border-radius:10px;font-size:24px;cursor:pointer;
  }
  .menuButton:hover { background:#009900; }

  .endlessBtn {
    background:#770000;border-color:#ff4444;color:white;
  }
  .endlessBtn:hover { background:#aa0000; }

  /* === HUD === */
  #sunCount {
    position:absolute;top:15px;left:15px;font-size:28px;
    color:yellow;font-family:Arial;text-shadow:2px 2px 4px black;
    z-index:10;
  }
  #levelInfo {
    position:absolute;top:15px;right:15px;font-size:24px;
    color:white;font-family:Arial;text-shadow:2px 2px 4px black;
    z-index:10;
  }

  /* === BİTKİ BUTONLARI === */
  #cards {
    position:absolute;top:60px;left:15px;
    display:flex;flex-direction:column;gap:10px;z-index:10;
  }
  .card {
    width:140px;height:55px;padding-top:6px;text-align:center;
    background:#444;border:2px solid #333;color:white;
    border-radius:10px;font-family:Arial;font-size:15px;
    cursor:pointer;line-height:1.2;
  }
  .card:hover { background:#777; }

  /* === OYUN KANVAS === */
  canvas { display:block;margin-left:180px;background:#2f7a2f; }
</style>
</head>

<body>

<!-- LOGO -->
<div id="logoScreen">
  <h1>YG STUDIOS</h1>
  <p style="color:white;font-family:Arial;font-size:22px;margin-top:10px;">
    Yurdakul Gaming
  </p>
</div>

<!-- MENÜ -->
<div id="menuWrapper">
  <div id="menuBox">

    <p style="color:white;font-family:Arial;font-size:18px;text-align:center;margin-bottom:10px;">
  Sunflower’dan düşen sarı güneş toplarını toplayarak puan kazanır ve bitkilerle kaleni korursun.
</p>

    <h1 style="color:yellow;font-family:Arial;">SELECT MODE</h1>

    <button class="menuButton" data-level="1">LEVEL 1</button>
    <button class="menuButton" data-level="2">LEVEL 2</button>
    <button class="menuButton" data-level="3">LEVEL 3</button>
    <button class="menuButton" data-level="4">LEVEL 4</button>
    <button class="menuButton" data-level="5">LEVEL 5</button>
    <button class="menuButton" data-level="6">LEVEL 6</button>

    <button class="menuButton endlessBtn" data-level="endless">ENDLESS MODE</button>
  </div>
</div>

<!-- HUD -->
<div id="sunCount">Sun: 50</div>
<div id="levelInfo">Level: 1</div>

<!-- Bitki Barı -->
<div id="cards"></div>

<!-- Oyun Alanı -->
<canvas id="game" width="1280" height="650"></canvas>

<script>
  let paused = false;
  
document.addEventListener("keydown", (e)=>{
  if(e.key.toLowerCase()==="p"){
    paused = !paused;
  }
});

/* ============================================================
   LOGO → MENÜ GEÇİŞİ
============================================================ */
setTimeout(()=>{
  document.getElementById("logoScreen").style.display="none";
  document.getElementById("menuWrapper").style.display="flex";
},2000);

/* ============================================================
   TEMEL AYARLAR
============================================================ */
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
const ROWS=5, COLS=9;
const CELL_W=120, CELL_H=130;

let sun=50;
let selectedPlant=null;
document.getElementById("sunCount").innerText="Sun: "+sun;

const grid=[];
for(let r=0;r<ROWS;r++){
  grid[r]=[];
  for(let c=0;c<COLS;c++) grid[r][c]=null;
}

const zombies=[];
const bullets=[];
const suns=[];

/* ============================================================
   BİTKİ BİLGİLERİ
============================================================ */
const PLANTS={
  sunflower:{id:"sunflower",name:"Sunflower",cost:50,hp:200,sunRate:4000,color:"yellow"},
  pea:{id:"pea",name:"Peashooter",cost:100,hp:250,damage:25,fireRate:1200,color:"lime"},
  ice:{id:"ice",name:"Ice Pea",cost:125,hp:250,damage:20,fireRate:1400,slow:true,color:"#33ccff"},
  wall:{id:"wall",name:"Wall-nut",cost:50,hp:600,color:"#8b5a2b"},
  bomb:{id:"bomb",name:"Cherry Bomb",cost:150,hp:100,bomb:true,range:180,damage:999,color:"red"}
};

/* ============================================================
   BİTKİ BUTONLARI
============================================================ */
const cardBar=document.getElementById("cards");
function drawCards(){
  cardBar.innerHTML="";
  Object.values(PLANTS).forEach(p=>{
    const d=document.createElement("div");
    d.className="card";
    d.innerHTML=p.name+"<br>("+p.cost+")";
    d.onclick=()=>{selectedPlant=p;drawCards();}
    if(selectedPlant && selectedPlant.id===p.id) d.style.background="#777";
    cardBar.appendChild(d);
  });
}
drawCards();

/* ============================================================
   LEVEL + ENDLESS MOD
============================================================ */
let gameMode="level"; // "endless"
let currentLevel=1;

const LEVEL_SPAWN_MS = {
  1: 12000,  // Level 1 → 12 saniyede 1 zombi
  2: 11000,  // Level 2 → 11 saniye
  3: 10000,  // Level 3 → 10 saniye
  4: 9000,   // Level 4 → 9 saniye
  5: 8000,   // Level 5 → 8 saniye
  6: 6500    // Level 6 → 6.5 saniye
};

const LEVEL_ZOMBIES={1:5,2:7,3:9,4:11,5:13,6:15};

let spawnTimer=0;
let zombiesSpawned=0;
let bossSpawned=false;
let leakedZombies=0;

/* ============================================================
   MENÜ TIKLAMA
============================================================ */
document.querySelectorAll(".menuButton").forEach(btn=>{
  btn.onclick=()=>{
    document.getElementById("menuWrapper").style.display="none";

    let lv=btn.getAttribute("data-level");

    if(lv==="endless"){
      gameMode="endless";
      document.getElementById("levelInfo").innerText="Endless";
    }else{
      gameMode="level";
      currentLevel=parseInt(lv);
      document.getElementById("levelInfo").innerText="Level: "+currentLevel;
    }
  };
});

/* ============================================================
   ZOMBİ OLUŞTURMA
============================================================ */
function spawnZombie(isBoss=false){
  const lane=Math.floor(Math.random()*ROWS);
  if(isBoss){
    zombies.push({lane,x:1280,y:lane*CELL_H+70,hp:800,maxHp:800,speed:0.3,boss:true});
  } else {
    zombies.push({lane,x:1280,y:lane*CELL_H+70,hp:150,maxHp:150,speed:0.45,boss:false});
  }
}

/* ============================================================
   LEVEL MANTIĞI
============================================================ */
function levelLogic(dt){
  if(gameMode==="endless"){ 
    endlessLogic(dt); 
    return; 
  }

  spawnTimer += dt;
  const interval = LEVEL_SPAWN_MS[currentLevel];

  // normal zombi spawn
  if(spawnTimer > interval && zombiesSpawned < LEVEL_ZOMBIES[currentLevel]){
    spawnTimer = 0;
    zombiesSpawned++;
    spawnZombie();
  }

  // boss spawn
  if(!bossSpawned &&
     zombiesSpawned >= LEVEL_ZOMBIES[currentLevel] &&
     zombies.filter(z => !z.boss).length === 0) {
      spawnZombie(true);
      bossSpawned = true;
  }

  // level biterse
  if(bossSpawned && zombies.length === 0){
    currentLevel++;

    // --- TÜM LEVEL BİTİNCE ---
    if(currentLevel > 6){
      alert("TEBRİKLER! TÜM LEVEL'LER BİTTİ! Lobiye dönüyorsunuz.");
      document.getElementById("menuWrapper").style.display = "flex";
      return;  // ÇOK ÖNEMLİ
    }

    // --- SONRAKİ LEVEL BAŞLAR ---
    resetLevel();
    alert("LEVEL " + currentLevel + " BAŞLIYOR!");
  }
}

  


/* ============================================================
   ENDLESS LOGIC
============================================================ */
let endlessTime=0;
let endlessDifficulty=1;

function endlessLogic(dt){
  endlessTime+=dt;

  if(endlessTime>6000/endlessDifficulty){
    endlessTime=0;
    spawnZombie();
    if(Math.random()<0.1) spawnZombie(true);
    endlessDifficulty+=0.05;
  }
}

/* ============================================================
   LEVEL RESET
============================================================ */
function resetLevel(){
  for(let r=0;r<ROWS;r++){
    for(let c=0;c<COLS;c++){
      grid[r][c]=null;
    }
  }
  zombies.length=0;
  bullets.length=0;
  suns.length=0;

  sun=50;
  document.getElementById("sunCount").innerText="Sun: "+sun;

  selectedPlant=null;
  drawCards();

  spawnTimer=0;
  zombiesSpawned=0;
  bossSpawned=false;
  leakedZombies=0;

  document.getElementById("levelInfo").innerText="Level: "+currentLevel;
}

/* ============================================================
   TIKLAMA — BİTKİ VE GÜNEŞ
============================================================ */
canvas.addEventListener("click",(e)=>{
  const rect=canvas.getBoundingClientRect();
  const mx=e.clientX-rect.left;
  const my=e.clientY-rect.top;

  const r=Math.floor(my/CELL_H);
  const c=Math.floor(mx/CELL_W);
  if(r<0||r>=ROWS||c<0||c>=COLS) return;

  for(let i=suns.length-1;i>=0;i--){
    const s=suns[i];
    if(Math.abs(mx-s.x)<30 && Math.abs(my-s.y)<30){
      sun+=25;
      document.getElementById("sunCount").innerText="Sun: "+sun;
      suns.splice(i,1);return;
    }
  }

  if(!selectedPlant) return;

  const info=selectedPlant;
  if(sun<info.cost) return;
  if(grid[r][c]!==null) return;

  grid[r][c]={type:info.id,hp:info.hp,row:r,col:c,shootTimer:0,sunTimer:0};
  sun-=info.cost;
  document.getElementById("sunCount").innerText="Sun: "+sun;

  selectedPlant=null;
  drawCards();
});

/* ============================================================
   BİTKİ, MERMİ, ZOMBİ UPDATE
============================================================ */
function updatePlants(dt){
  for(let r=0;r<ROWS;r++){
    for(let c=0;c<COLS;c++){
      const p=grid[r][c];
      if(!p) continue;

      const info=PLANTS[p.type];

      if(p.type==="sunflower"){
        p.sunTimer+=dt;
        if(p.sunTimer>info.sunRate){
          p.sunTimer=0;
          suns.push({x:c*CELL_W+70,y:r*CELL_H+20,vy:1});
        }
      }

      if(info.bomb){
        p.shootTimer+=dt;
        if(p.shootTimer>900){
          zombies.forEach(z=>{
            let dx=z.x-(c*CELL_W+60);
            let dy=z.y-(r*CELL_H+60);
            let d=Math.sqrt(dx*dx+dy*dy);
            if(d<info.range) z.hp-=info.damage;
          });
          grid[r][c]=null;
        }
      }

      if(info.fireRate){
        const target=zombies.some(z=>z.lane===r && z.x>c*CELL_W);
        if(target){
          p.shootTimer+=dt;
          if(p.shootTimer>info.fireRate){
            p.shootTimer=0;
            bullets.push({
              x:c*CELL_W+80,y:r*CELL_H+60,
              lane:r,dmg:info.damage,slow:info.slow||false
            });
          }
        }
      }

      if(p.hp<=0) grid[r][c]=null;
    }
  }
}

function updateBullets(dt){
  for(let i=bullets.length-1;i>=0;i--){
    const b=bullets[i];
    b.x+=6;

    for(let j=zombies.length-1;j>=0;j--){
      const z=zombies[j];
      if(z.lane===b.lane && Math.abs(z.x-b.x)<30){
        z.hp-=b.dmg;
        if(b.slow && !z.boss) z.speed*=0.7;
        bullets.splice(i,1);
        break;
      }
    }

    if(b.x>1280) bullets.splice(i,1);
  }
}

function updateZombies(dt){
  for(let i=zombies.length-1;i>=0;i--){
    const z=zombies[i];
    const c=Math.floor(z.x/CELL_W);

    const p=(c>=0&&c<COLS)? grid[z.lane][c] : null;

    if(p){
      p.hp-=0.25;
    } else {
      z.x-=z.speed;
    }

    if(z.hp<=0){
      zombies.splice(i,1);continue;
    }

    if(z.x<0){
      if(gameMode==="level"){
        leakedZombies++;
        if(leakedZombies>=2){
          alert("2 zombi içeri girdi. Kaybettin!");
          location.reload();
        }
      }
      zombies.splice(i,1);
    }
  }
}

function updateSuns(dt){
  suns.forEach(s=>{
    s.y+=s.vy;
    if(s.y>600) s.y=600;
  });
}

/* ============================================================
   ÇİZİM
============================================================ */
function drawGrid(){
  for(let r=0;r<ROWS;r++){
    for(let c=0;c<COLS;c++){
      ctx.strokeStyle="#1e4f1e";
      ctx.strokeRect(c*CELL_W,r*CELL_H,CELL_W,CELL_H);
    }
  }
}
function drawPlants(){
  for(let r=0;r<ROWS;r++){
    for(let c=0;c<COLS;c++){
      const p=grid[r][c];
      if(!p) continue;

      const info=PLANTS[p.type];

      ctx.fillStyle=info.color;
      ctx.beginPath();
      ctx.arc(c*CELL_W+60,r*CELL_H+60,30,0,Math.PI*2);
      ctx.fill();

      ctx.fillStyle="red";
      ctx.fillRect(c*CELL_W+30,r*CELL_H+95,60,8);
      ctx.fillStyle="lime";
      ctx.fillRect(c*CELL_W+30,r*CELL_H+95,(p.hp/info.hp)*60,8);
    }
  }
}
function drawBullets(){
  ctx.fillStyle="orange";
  bullets.forEach(b=>{
    ctx.beginPath();
    ctx.arc(b.x,b.y,8,0,Math.PI*2);
    ctx.fill();
  });
}
function drawZombies(){
  zombies.forEach(z=>{
    ctx.fillStyle=z.boss?"#ffdd00":"#663300";
    ctx.fillRect(z.x-30,z.y-50,60,100);

    ctx.fillStyle="red";
    ctx.fillRect(z.x-30,z.y-60,60,6);
    ctx.fillStyle="lime";
    ctx.fillRect(z.x-30,z.y-60,(z.hp/z.maxHp)*60,6);

    if(z.boss){
      ctx.fillStyle="black";
      ctx.font="20px Arial";
      ctx.fillText("BOSS",z.x-28,z.y-65);
    }
  });
}
function drawSuns(){
  ctx.fillStyle="yellow";
  suns.forEach(s=>{
    ctx.beginPath();
    ctx.arc(s.x,s.y,20,0,Math.PI*2);
    ctx.fill();
  });
}

/* ============================================================
   GAME LOOP
============================================================ */
let last = 0;
function loop(ts){
  let dt = ts - last;
  last = ts;

  // === PAUSE KONTROLÜ ===
  if (paused) {
    ctx.fillStyle = "rgba(0,0,0,0.5)";
    ctx.fillRect(0, 0, 1280, 650);

    ctx.fillStyle = "white";
    ctx.font = "60px Arial Black";
    ctx.fillText("PAUSED", 500, 330);

    requestAnimationFrame(loop);
    return;
  }

  updatePlants(dt);
  updateBullets(dt);
  updateZombies(dt);
  updateSuns(dt);
  levelLogic(dt);

  ctx.clearRect(0,0,1280,650);
  drawGrid();
  drawPlants();
  drawBullets();
  drawZombies();
  drawSuns();

  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

</script>

</body>
</html>
